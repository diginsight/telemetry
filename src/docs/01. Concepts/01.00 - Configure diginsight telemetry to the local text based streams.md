---
title: "Configure the local text based streams"
---

## HowTo: Configure diginsight telemetry to the local text based streams
You can ottain a __console log__ or __file log__ with diginsight by means of the steps shown below.<br>
The code snippets are available as working samples within the [telemetry.samples](https://github.com/diginsight/telemetry.samples) repository.

Article [HOWTO - Use Diginsight Samples.md](<15.00 - HowTo - Use Diginsight Samples.md>): explores how we can use diginsight samples to test and understand integration of Diginsight telemetry in our own projects.

## STEP 01 - Add a package reference to the package `Diginsight.Diagnostics` or `Diginsight.Diagnostics.Log4Net`
In the first step you can just add a diginsight reference to your code:<br>
![alt text](<01.00 - Configure diginsight telemetry to the local text based streams/001.01 STEP1 - add reference.png>)

## STEP 02 - Configure logging within the Startup sequence
in the second step you can configure the startup sequence to enable  diginsight log:
![alt text](<01.00 - Configure diginsight telemetry to the local text based streams/002.01 STEP2 - configure logging.png>)
in this case: 
- __AddObservability()__ is used to add log to the application Console and a log4net file log.
- __UseDiginsightServiceProvider()__ is used to activate diginsight during the service provider build() process.

please note that __AddObservability()__ is implemented as an extension method that calls __AddLogging()__ with:
- __AddDiginsightConsole()__: this methods configures the __Console log__ provider with some formatting options
![alt text](<01.00 - Configure diginsight telemetry to the local text based streams/002.02 STEP2 - AddDiginsightConsole.png>)

- __AddDiginsightLog4Net()__: this methods configures a rolling __File log__ on the user profile folder.
![alt text](<01.00 - Configure diginsight telemetry to the local text based streams/002.03 STEP2 - AddDiginsightLog4Net.png>)

<br>

also, note that the __Diginsight:Activities__ configuration section is loaded to specify __enabled ActivitySources__ and their __LogBehavior__. <br>
```json#
"Diginsight": {
    "Activities": {
        "LogBehavior": "Show",
        "MeterName": "SampleWebAPI",
        "ActivitySources": {
        "Microsoft.AspNetCore": true,
        "System.Net.Http": true,
        "Experimental.*": false,
        "Diginsight.*": true,
        "SampleWebAPI": true
        },
        "LoggedActivityNames": {
        "System.Net.Http|System.Net.Http.HttpRequestOut": "Hide",
        "Microsoft.AspNetCore.Hosting.HttpRequestIn": "Hide"
        }
    }
}
```
Activities LogBehavior can be set to:
- __Show__: the activity is logged.
- __Hide__: the activity is not logged.
- __Truncate__: the activity and all __inner activities called within its scope__ are not logged.


## STEP 03 - Add telemetry to code with `StartMethodActivity()` and `ILogger` Statements
we are now ready to add instrumentation to the code and make the application flow observable:
```c#
[HttpGet(Name = "GetWeatherForecast")]
public IEnumerable<WeatherForecast> Get()
{
    using var activity = Observability.ActivitySource.StartMethodActivity(logger);

    var randomTemperature = Random.Shared.Next(-20, 55);
    logger.LogDebug("randomTemperature: {randomTemperature}", randomTemperature);

    var res = Enumerable.Range(1, 5).Select(index => new WeatherForecast
    {
        Date = DateOnly.FromDateTime(DateTime.Now.AddDays(index)),
        TemperatureC = randomTemperature,
        Summary = Summaries[Random.Shared.Next(Summaries.Length)]
    }).ToArray();

    activity?.SetOutput(res);
    return res;
}
```
in the snippet above:
- `using var activity = Observability.ActivitySource.StartMethodActivity(logger);` is added to provide observability of method start and end
- `logger.LogDebug("randomTemperature: {randomTemperature}", randomTemperature);` is usd to log the randomTemperature value, during the method execution.
- `activity.SetOutput(result);` is used at the method end to log the method result

## STEP 04 - run your code and look at the resulting application flow 
the image below shows the application flow generated by DoSomeWork method 
The image belpw shows the sample method execution, where method start and end are logged with the __Method__ name, randomTemperature is logged as a standard variable value and the __method result__ is logged within the method END raw.<br> 
![alt text](<01.00 - Configure diginsight telemetry to the local text based streams/004.01 STEP4 - AddDiginsightLog4Net.png>)
