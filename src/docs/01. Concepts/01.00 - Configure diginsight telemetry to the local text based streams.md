---
title: "Configure the local text based streams"
---

## HowTo: Configure diginsight telemetry to the local text based streams
You can ottain a __console log__ or __file log__ with diginsight by means of the steps shown below.<br>
The code snippets are available as working samples within the [telemetry_samples](https://github.com/diginsight/telemetry_samples) repository.

Article [HOWTO - Use Diginsight Samples.md](<15.00 - HowTo - Use Diginsight Samples.md>): explores how we can use diginsight samples to test and understand integration of Diginsight telemetry in our own projects.

## STEP 01 - Add a package reference to the package `Diginsight.Diagnostics` or `Diginsight.Diagnostics.Log4Net`
In the first step you can just add a diginsight reference to your code:<br>
![Alt text](<01.00 - Configure diginsight telemetry to the local text based streams/004.01 STEP1 - add reference.png>)

## STEP 02 - Configure logging within the Startup sequence
in the second step you can configure the startup sequence to enable  diginsight log:
![alt text](<01.00 - Configure diginsight telemetry to the local text based streams/004.02b STEP - configure logging.png>)

in this case: 
- __AddDiginsightConsole()__ is used to enabled log to the application Console.
- __AddDiginsightLog4Net()__ is used to enabled file log by means of log4net.

a separate - __log4net.config__ can be used to specify the usual log4net configuration:
![alt text](<01.00 - Configure diginsight telemetry to the local text based streams/004.03 Log4Net configuration file.png>)

also, the __Diginsight:Activities__ section can be used to specify __enabled ActivitySources__ and whether __Activity logging__ is enabled. <br>
![alt text](<01.00 - Configure diginsight telemetry to the local text based streams/004.04 DiginsightActivities configuration.png>)

## STEP 03 - Add telemetry to code with `StartMethodActivity()` and `ILogger` Statements
we are now ready to add instrumentation to the code and make the application flow observable:
```c#
[HttpGet("dosomework", Name = "DoSomeWork")]
[ApiVersion(ApiVersions.V_2024_04_26.Name)]
public async Task DoSomeWork()
{
    using var activity = Program.ActivitySource.StartMethodActivity(logger); 

    var result1 = await StepOne();
    logger.LogDebug("await StepOne(); returned {result1}", result1);

    var result2 = await StepTwo();
    logger.LogDebug("await StepTwo(); completed {result2}", result2);

    var result = result1 + result2;

    activity.SetOutput(result);
    return;
}
```
in the snippet above, the DoSomeWork method from Diginsight telemetry_samples repository is shown where:
- `using var activity = Program.ActivitySource.StartMethodActivity(logger);` is added to provide observability of method start and end
- `logger.LogDebug("await StepTwo(); completed {result2}", result2);` are added during the method execution
- `activity.SetOutput(result);` is used at the method end to log the method result

## STEP 04 - run your code and look at the resulting application flow 
the image below shows the application flow generated by DoSomeWork method 
![alt text](<01.00 - Configure diginsight telemetry to the local text based streams/004.06 View application flow.png>)